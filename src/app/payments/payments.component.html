<body scroll="no">
    <!-- header da aplicação -->
    <header class="p-4">
        <div class="d-flex justify-content-between align-items-center">
            <div class="p-2">
                <img src="./../../../../assets/payfriends-logo-blank.svg" alt="">
            </div>
            <div class="p-2 d-flex flex-row-reverse align-items-center">

                <div class="p-2">
                    <a class="logout-link" (click)="logout()">Sair</a>
                </div>
                <div class="p-2"><img src="./../../../../assets/darth_vader_profile.png" alt="" width="45" height="45"
                        class="rounded-circle">
                </div>
                <div class="p-2" style="color: white;" *ngIf="profileData">
                    Olá,<span class="usuario-nome-text"> {{profileData.name}}!</span>
                </div>
            </div>
        </div>
    </header>
    <!-- container com a região de pagamentos -->
    <div class="container">
        <div class="row mt-5">
            <p class="meus-pagamentos-text">Meus pagamentos</p>
        </div>
        <div class="row">
            <div class="col d-flex flex-row-reverse">
                <button class="btn btn-primary btn-xs" type="button" data-bs-toggle="modal"
                    data-bs-target="#paymentModal" (click)="clickAddPayment()">ADICIONAR PAGAMENTO</button>
            </div>
        </div>
        <div class="row mt-3">
            <div class="p-4 bg-white rounded" *ngIf="payments">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="form-outline w-20">
                        <input type="search" id="form1" class="form-control w-100" placeholder="Pesquisar"
                            aria-label="Search" (keyup)="filter($event)" />
                    </div>
                    <div>
                        <mat-paginator [length]="payments.length" [pageSize]="5" [pageSizeOptions]="[5, 10, 15, 20]"
                            aria-label="Select page" class="d-flex align-items-end">
                        </mat-paginator>
                    </div>
                </div>

                <!-- tabela e suas linhas e colunas -->
                <table mat-table [dataSource]="dataSource" matSort matSortActive="created" matSortDisableClear
                    matSortDirection="desc">
                    <!-- coluna user -->
                    <ng-container matColumnDef="username">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Usuário</th>
                        <td mat-cell *matCellDef="let row"> {{row.name}} <br> <span
                                class="secondary-text">@{{row.username}}</span></td>
                    </ng-container>
                    <!-- coluna título -->
                    <ng-container matColumnDef="title">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Título</th>
                        <td mat-cell *matCellDef="let row"> {{row.title}}</td>
                    </ng-container>
                    <!-- coluna data -->
                    <ng-container matColumnDef="date">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Data</th>
                        <td mat-cell *matCellDef="let row"> {{row.date | date:'dd/MM/yyyy': 'UTC'}}<br><span
                                class="secondary-text">{{row.date | date:'hh:mm a': 'UTC'}}</span></td>
                    </ng-container>
                    <!-- coluna valor -->
                    <ng-container matColumnDef="value">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Valor</th>
                        <td mat-cell *matCellDef="let row">{{row.value | currency : 'BRL'}}</td>
                    </ng-container>
                    <!-- coluna checkbox de pagamento -->
                    <ng-container matColumnDef="isPayed">
                        <th mat-header-cell *matHeaderCellDef>
                            <div class="d-flex justify-content-center">
                                Pago
                            </div>
                        </th>
                        <td mat-cell *matCellDef="let row">
                            <div class="d-flex justify-content-center">
                                <input class="form-check-input" type="checkbox" id="chk1" [(ngModel)]="row.isPayed"
                                    (change)="onChangeCheckBox($event, row)">
                            </div>
                        </td>
                    </ng-container>
                    <!-- coluna de ações: editar e deletar -->
                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef></th>
                        <td mat-cell *matCellDef="let row">
                            <div class="d-flex justify-content-end">
                                <img class="icon" type="button" data-bs-toggle="modal" data-bs-target="#paymentModal"
                                    (click)="onEdit(row)" src="./../../assets/pen_icon.svg" alt="">
                                <img type="button" data-bs-toggle="modal" data-bs-target="#deleteModal"
                                    (click)="onDelete(row)" class="icon" src="./../../assets/delete_icon.svg" alt="">
                            </div>
                        </td>
                    </ng-container>
                    <!-- definindo colunas -->
                    <tr mat-header-row *matHeaderRowDef="columns"></tr>
                    <tr mat-row *matRowDef="let row; columns: columns;"></tr>
                </table>
            </div>
        </div>
    </div>

    <!-- modal adicionar/editar pagamento -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel" *ngIf="!isEditing">Adicionar pagamento</h5>
                    <h5 class="modal-title" id="paymentModalLabel" *ngIf="isEditing">Editar pagamento</h5>
                </div>
                <div class="modal-body">
                    <form [formGroup]="formValue">
                        <div class="row">
                            <div class="mb-3">
                                <input type="text" formControlName="name" class="form-control w-100" placeholder="Nome">
                            </div>
                        </div>
                        <div class="row">
                            <div class="mb-3 col-6">
                                <input type="text" formControlName="username" class="form-control w-100"
                                    placeholder="Usuário">
                            </div>
                            <div class="mb-3 col-6">
                                <input type="text" formControlName="title" class="form-control w-100"
                                    placeholder="Título">
                            </div>
                        </div>
                        <div class="row">
                            <div class="mb-3 col-8">
                                <input type="datetime-local" formControlName="date" class="form-control w-100" placeholder="Data" step="1">
                            </div>
                            <div class="mb-3 col-4">
                                <!-- input do módulo de máscara para currency -->
                                <input currencyMask formControlName="value" class="form-control w-100" placeholder="Valor"
                                    [options]="{ prefix: 'R$ ', thousands: '.', decimal: ',' }" />
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="cancelPayment" class="btn btn-secondary"
                        data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" (click)="newPayment()" class="btn btn-primary" [disabled]="!formValue.valid || !formValue.dirty"
                        *ngIf="!isEditing">Salvar</button>
                    <button type="button" (click)="changePayment()" class="btn btn-primary" [disabled]="!formValue.valid || !formValue.dirty"
                        *ngIf="isEditing">Editar</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal confirmar delete de pagamento -->
    <div class="modal" id="deleteModal" tabindex="-1" class="modal fade" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Excluir pagamento</h5>
                </div>
                <div class="modal-body">
                    <p>Usuário: {{paymentToDelete.name}}</p>
                    <p>Data: {{paymentToDelete.date | date:'dd/MM/yyyy': 'UTC'}}</p>
                    <p>Valor: {{paymentToDelete.value | currency : 'BRL'}}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="cancelDeletePayment" class="btn btn-secondary"
                        data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" (click)="removePayment()">Excluir</button>
                </div>
            </div>
        </div>
    </div>
</body>